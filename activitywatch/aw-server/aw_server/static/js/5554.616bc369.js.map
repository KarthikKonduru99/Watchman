{"version":3,"file":"js/5554.616bc369.js","mappings":"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","sources":["webpack://aw-webui/./src/views/Trends.vue","webpack://aw-webui/./src/views/Trends.vue?cccd","webpack://aw-webui/./src/views/Trends.vue?3c79","webpack://aw-webui/./src/views/Trends.vue?049e","webpack://aw-webui/./src/util/datasets.ts"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('h3',{staticClass:\"mb-0\"},[_vm._v(\"Trends for \"+_vm._s(_vm._f(\"friendlyperiod\")(_vm.timeperiod)))]),_c('b-input-group',{attrs:{\"size\":\"sm\"}},[_c('b-form-select',{attrs:{\"label\":\"Host\",\"options\":_vm.bucketsStore.hosts,\"placeholder\":\"Select a hostname\"},model:{value:(_vm.host),callback:function ($$v) {_vm.host=$$v},expression:\"host\"}})],1),_c('div',{staticClass:\"mb-2\"},[_c('ul',{staticClass:\"list-group list-group-horizontal-md mb-3\",staticStyle:{\"font-size\":\"0.9em\",\"opacity\":\"0.7\"}},[_c('li',{staticClass:\"list-group-item pl-0 pr-3 py-0 border-0\"},[_c('b',[_vm._v(\"Host:\")]),_vm._v(\" \"+_vm._s(_vm.host))])])]),_c('b-alert',{staticStyle:{},attrs:{\"show\":\"\"}},[_vm._v(\"This feature is still in early development.\")]),_c('div',[_c('aw-timeline-barchart',{attrs:{\"datasets\":_vm.datasets,\"height\":100}})],1),_c('div',[_c('hr'),_c('h5',[_vm._v(\"Options\")]),_c('aw-devonly',[_c('b-btn',{attrs:{\"id\":\"load-demo\"},on:{\"click\":_vm.load_demo}},[_vm._v(\"Load demo data\")])],1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\nimport moment from 'moment';\nimport { get_today_with_offset } from '~/util/time';\nimport { buildBarchartDataset } from '~/util/datasets';\n\nimport { useBucketsStore } from '~/stores/buckets';\nimport { useCategoryStore } from '~/stores/categories';\nimport { useActivityStore, QueryOptions } from '~/stores/activity';\n\nexport default {\n  name: 'Trends',\n  props: {},\n  data: function () {\n    const today = get_today_with_offset();\n    const n_days = 7;\n    const since = moment(today).subtract(n_days, 'days');\n    return {\n      bucketsStore: useBucketsStore(),\n      categoryStore: useCategoryStore(),\n      activityStore: useActivityStore(),\n\n      today,\n      timeperiod: { start: since, length: [n_days, 'day'] },\n    };\n  },\n\n  computed: {\n    host() {\n      return this.$route.params.host;\n    },\n    datasets: function () {\n      return buildBarchartDataset(\n        this.activityStore.category.by_period,\n        this.categoryStore.classes\n      );\n    },\n  },\n\n  mounted: async function () {\n    this.categoryStore.load();\n    await this.refresh();\n  },\n\n  methods: {\n    refresh: async function (force) {\n      const queryParams: QueryOptions = {\n        timeperiod: this.timeperiod,\n        host: this.host,\n        force,\n        filter_afk: this.filter_afk,\n        include_audible: this.include_audible,\n        filter_categories: this.filter_categories,\n        dont_query_inactive: false,\n      };\n      await this.activityStore.query_category_time_by_period(queryParams);\n    },\n\n    load_demo: async function () {\n      this.data = { '2021-01': 1000, '2021-02': 500 };\n    },\n  },\n};\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??clonedRuleSet-38.use[2]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Trends.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??clonedRuleSet-38.use[2]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Trends.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Trends.vue?vue&type=template&id=7456416a&scoped=true&lang=pug&\"\nimport script from \"./Trends.vue?vue&type=script&lang=ts&\"\nexport * from \"./Trends.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7456416a\",\n  null\n  \n)\n\nexport default component.exports","import _ from 'lodash';\n\nimport { split_by_hour_into_data } from '~/util/transforms';\nimport { getColorFromCategory } from '~/util/color';\nimport { Category } from '~/util/classes';\nimport { IEvent } from './interfaces';\nimport { useCategoryStore } from '~/stores/categories';\n\ninterface HourlyData {\n  cat_events: IEvent[];\n}\n\ninterface Dataset {\n  label: string;\n  backgroundColor: string;\n  data: number[];\n}\n\nexport function buildBarchartDataset(data_by_hour: HourlyData[], classes: Category[]): Dataset[] {\n  const SEP = '>>>';\n  const data = data_by_hour;\n  if (data) {\n    const category_names: Set<string> = new Set(\n      Object.values(data)\n        .map(result => {\n          return result.cat_events.map(e => e.data['$category'].join(SEP));\n        })\n        .flat()\n    );\n    const ds: Dataset[] = [...category_names]\n      .map(c_ => {\n        const categoryStore = useCategoryStore();\n        const c = categoryStore.get_category(c_.split(SEP));\n\n        if (c) {\n          const values = Object.values(data).map(results => {\n            const cat = results.cat_events.find(e => _.isEqual(e.data['$category'], c.name));\n            if (cat) return Math.round((cat.duration / (60 * 60)) * 1000) / 1000;\n            else return null;\n          });\n          return {\n            label: c.name.join(' > '),\n            backgroundColor: getColorFromCategory(c, classes),\n            data: values,\n          } as Dataset;\n        } else {\n          // FIXME: This shouldn't happen\n          // This may for example happen if one doesn't have an 'Uncategorized' category,\n          // as can happen when one upgrades from an old version where there wasn't one in the default classes.\n          console.error('missing category:', c_);\n        }\n      })\n      .filter(x => x);\n    return ds;\n  } else {\n    return [];\n  }\n}\n\nexport function buildBarchartDatasetActive(events_active: IEvent[]) {\n  const data = split_by_hour_into_data(events_active);\n  return [\n    {\n      label: 'Total time',\n      backgroundColor: '#6699ff',\n      data,\n    },\n  ];\n}\n"],"names":["render","_vm","this","_c","_self","staticClass","_v","_s","_f","timeperiod","attrs","bucketsStore","hosts","model","value","host","callback","$$v","expression","staticStyle","datasets","on","load_demo","staticRenderFns","name","props","data","today","get_today_with_offset","n_days","since","moment","subtract","useBucketsStore","categoryStore","useCategoryStore","activityStore","useActivityStore","start","length","computed","$route","params","buildBarchartDataset","category","by_period","classes","mounted","load","refresh","methods","force","queryParams","filter_afk","include_audible","filter_categories","dont_query_inactive","query_category_time_by_period","component","data_by_hour","SEP","category_names","Set","Object","values","map","result","cat_events","e","join","flat","ds","c_","c","get_category","split","results","cat","find","Math","round","duration","label","backgroundColor","getColorFromCategory","console","error","filter","x"],"sourceRoot":""}