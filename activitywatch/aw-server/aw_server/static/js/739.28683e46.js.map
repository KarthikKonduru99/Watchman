{"version":3,"file":"js/739.28683e46.js","mappings":"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","sources":["webpack://aw-webui/./src/views/settings/CategoryBuilder.vue","webpack://aw-webui/./src/views/settings/CategoryBuilder.vue?a22a","webpack://aw-webui/./src/views/settings/CategoryBuilder.vue?4c75","webpack://aw-webui/./src/views/settings/CategoryBuilder.vue?fa2a","webpack://aw-webui/./node_modules/lodash/escapeRegExp.js"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('h1',[_vm._v(\"Categorization helper\")]),_c('div',[_c('p',[_vm._v(\"This tool will help you create categories from your uncategorized time.\")]),_c('p',[_vm._v(\"It works by fetching all uncategorized time for a recent timeperiod, and then finds the most common words (by time, not count) each of which may then either be ignored (if too broad/irrelevant), or used to create a new (sub)category, or to append the word to a pre-existing category rule. Words with less than 60s of time will not be shown.\")]),_c('p',[_vm._v(\"When you're done, you can inspect the categories in the \"),_c('router-link',{attrs:{\"to\":{ path: '/settings' }}},[_vm._v(\"Settings\")]),_vm._v(\" page.\")],1)]),_c('div',{staticClass:\"d-flex\"},[_c('div',{staticClass:\"flex-grow-1\"},[_vm._m(0),_c('div',[_c('small',[_vm._v(\"Hostname: \"+_vm._s(_vm.queryOptions.hostname))])]),_c('div',[_c('small',[_vm._v(\"Range: \"+_vm._s(_vm.queryOptions.start)+\" - \"+_vm._s(_vm.queryOptions.stop))])])]),_c('div',{staticClass:\"flex-grow-0\"},[_c('b-button',{attrs:{\"variant\":\"outline-dark\",\"size\":\"sm\"},on:{\"click\":function($event){_vm.show_options = !_vm.show_options}}},[(!_vm.show_options)?_c('span',[_vm._v(\"Show options\")]):_c('span',[_vm._v(\"Hide options\")])])],1)]),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.show_options),expression:\"show_options\"}]},[_c('hr'),_c('h4',[_vm._v(\"Options\")]),_c('aw-query-options',{model:{value:(_vm.queryOptions),callback:function ($$v) {_vm.queryOptions=$$v},expression:\"queryOptions\"}})],1),_c('hr'),_c('h5',[_vm._v(\"Common words in \\\"\"+_vm._s(_vm.category.join(\" > \"))+\"\\\" events\")]),(_vm.loading)?_c('div',[_vm._v(\"Loading...\")]):_c('div',[(_vm.words_by_duration.length == 0)?_c('div',[_vm._v(\"No words with significant duration. You're good to go!\")]):_c('div',_vm._l((_vm.words_by_duration),function(word){return _c('div',{staticClass:\"row\"},[_c('div',{staticClass:\"col hover-highlight\"},[_c('div',{staticClass:\"d-flex flex-row py-2\"},[_c('div',{staticClass:\"flex-grow-1\"},[_vm._v(_vm._s(word.word)+\" (\"+_vm._s(Math.round(word.duration))+\"s)\")]),_c('div',{staticClass:\"flex-grow-0\"},[_c('b-button',{staticClass:\"mr-1\",attrs:{\"size\":\"sm\",\"variant\":\"success\"},on:{\"click\":function($event){return _vm.createRule(word.word)}}},[_vm._v(\"New rule\")]),_c('b-button',{staticClass:\"mr-1\",attrs:{\"size\":\"sm\",\"variant\":\"warning\"},on:{\"click\":function($event){return _vm.appendRule(word.word)}}},[_vm._v(\"Append rule\")]),_c('b-button',{staticClass:\"mr-1\",attrs:{\"size\":\"sm\"},on:{\"click\":function($event){return _vm.ignoreWord(word.word)}}},[_vm._v(\"Ignore\")]),_c('b-button',{attrs:{\"size\":\"sm\",\"variant\":\"outline-dark\"},on:{\"click\":function($event){return _vm.showEvents(word)}}},[(_vm.showing_events[0] != word)?_c('span',[_vm._v(\"Show events\")]):_c('span',[_vm._v(\"Hide events\")])])],1)]),(_vm.showing_events && _vm.showing_events[0] == word)?_c('div',[_c('table',{staticClass:\"table table-sm table-striped\"},[_vm._m(1,true),_vm._l((_vm.showing_events[1]),function(event){return _c('tr',[_c('td',[_vm._v(_vm._s(event.data.title))]),_c('td',{staticClass:\"text-right\"},[_vm._v(_vm._s(Math.round(event.duration))+\"s\")])])})],2),_c('hr')]):_vm._e()])])}),0)]),(_vm.create.categoryId !== null)?_c('div',[_c('CategoryEditModal',{attrs:{\"categoryId\":_vm.create.categoryId},on:{\"ok\":function($event){return _vm.createRuleOk()},\"hidden\":function($event){return _vm.createRuleCancel()}}})],1):_vm._e(),_c('b-modal',{attrs:{\"id\":\"appendRule\",\"title\":\"Append rule\",\"ok-disabled\":!_vm.valid},on:{\"ok\":_vm.handleOk}},[_c('b-form',{ref:\"form\",on:{\"submit\":function($event){$event.stopPropagation();$event.preventDefault();return _vm.handleSubmit.apply(null, arguments)}}},[_c('b-form-group',{attrs:{\"label\":\"Rule\",\"label-for\":\"append-category\",\"invalid-feedback\":\"Category is required\",\"state\":_vm.validCategory,\"required\":\"\"}},[_c('b-form-select',{attrs:{\"id\":\"append-category\"},model:{value:(_vm.append.category),callback:function ($$v) {_vm.$set(_vm.append, \"category\", $$v)},expression:\"append.category\"}},_vm._l((_vm.allCategoriesSelect),function(cat){return _c('b-form-select-option',{key:cat.id,attrs:{\"value\":cat.value}},[_vm._v(_vm._s(cat.text))])}),1)],1),_c('b-form-group',{attrs:{\"label\":\"Word\"}},[_c('b-form-input',{model:{value:(_vm.append.word),callback:function ($$v) {_vm.$set(_vm.append, \"word\", $$v)},expression:\"append.word\"}}),_c('small',[(_vm.validPattern)?_c('div',{staticStyle:{\"color\":\"green\"}},[_vm._v(\"Valid\")]):_c('div',{staticStyle:{\"color\":\"red\"}},[_vm._v(\"Invalid pattern\")]),(_vm.validPattern && _vm.broad_pattern)?_c('div',{staticStyle:{\"color\":\"orange\"}},[_vm._v(\"Pattern too broad\")]):_vm._e()])],1)],1)],1)],1)\n}\nvar staticRenderFns = [function (){var _vm=this,_c=_vm._self._c;return _c('div',[_c('b',[_vm._v(\"Options\")])])\n},function (){var _vm=this,_c=_vm._self._c;return _c('tr',[_c('th',[_vm._v(\"Title\")]),_c('th',{staticClass:\"text-right\"},[_vm._v(\"Duration\")])])\n}]\n\nexport { render, staticRenderFns }","\nimport _ from 'lodash';\nimport moment from 'moment';\nimport { mapState } from 'pinia';\n\nimport { useCategoryStore } from '~/stores/categories';\nimport { useBucketsStore } from '~/stores/buckets';\n\nimport { canonicalEvents } from '~/queries';\nimport { getClient } from '~/util/awclient';\nimport CategoryEditModal from '~/components/CategoryEditModal.vue';\nimport { isRegexBroad, validateRegex } from '~/util/validate';\n\nexport default {\n  name: 'aw-category-builder',\n  components: { CategoryEditModal },\n  props: {},\n  data() {\n    return {\n      loading: true,\n\n      categoryStore: useCategoryStore(),\n\n      // Options\n      show_options: false,\n      queryOptions: {\n        start: moment().subtract(1, 'day'),\n        stop: moment().add(1, 'day'),\n      },\n\n      // TODO: Support inspecting a different category than Uncategorized (e.g. to make some category more precise)\n      category: ['Uncategorized'],\n\n      words: {},\n      showing_events: [],\n\n      // TODO: load from settings\n      ignored_words: [],\n\n      append: {\n        word: '',\n        category: [],\n      },\n      create: {\n        word: '',\n        categoryId: null,\n      },\n    };\n  },\n  computed: {\n    ...mapState(useCategoryStore, ['allCategoriesSelect']),\n    words_by_duration: function () {\n      return Object.values(this.words)\n        .sort((a, b) => b.duration - a.duration)\n        .filter(word => word.duration > 60)\n        .filter(word => !this.ignored_words.includes(word.word));\n    },\n    valid: function () {\n      return this.validPattern && this.validCategory;\n    },\n    validPattern: function () {\n      return validateRegex(this.append.word);\n    },\n    validCategory: function () {\n      return this.append.category.length > 0;\n    },\n    broad_pattern: function () {\n      return isRegexBroad(this.append.word);\n    },\n  },\n  watch: {\n    queryOptions: {\n      handler: function () {\n        this.fetchWords();\n      },\n      deep: true,\n    },\n  },\n  async mounted() {\n    // Make sure we don't have stale unsaved changes in categoryStore\n    await useBucketsStore().ensureLoaded();\n    await this.categoryStore.load();\n    // Called by watch\n    //await this.fetchWords();\n  },\n  methods: {\n    async fetchWords() {\n      this.loading = true;\n      if (!this.queryOptions.hostname) {\n        // FIXME: This is a hack to ensure that the hostname is set (otherwise isn't due to some race condition)\n        this.queryOptions.hostname = useBucketsStore().hosts[0];\n      }\n      await this.categoryStore.load();\n      const awclient = getClient();\n      const query =\n        canonicalEvents({\n          bid_window: 'aw-watcher-window_' + this.queryOptions.hostname,\n          bid_afk: 'aw-watcher-afk_' + this.queryOptions.hostname,\n          filter_afk: this.queryOptions.filter_afk,\n          categories: this.categoryStore.classes_for_query,\n          filter_categories: [this.category],\n        }) + 'RETURN = limit_events(sort_by_duration(events), 1000);';\n      const data = await awclient.query(\n        [\n          {\n            start: new Date(this.queryOptions.start),\n            end: new Date(this.queryOptions.stop),\n          },\n        ],\n        query.split('\\n')\n      );\n\n      const events = data[0];\n      const words = {};\n      for (const event of events) {\n        const words_in_event = event.data.title.split(/[\\s\\-,:()[\\]/]/);\n        for (const word of words_in_event) {\n          if (word.length <= 2 || this.ignored_words.includes(word)) {\n            continue;\n          }\n          if (word in words) {\n            words[word].duration += event.duration;\n            words[word].events.push(event);\n          } else {\n            words[word] = {\n              word: word,\n              duration: event.duration,\n              events: [event],\n            };\n          }\n        }\n      }\n      this.words = words;\n      this.loading = false;\n    },\n    showEvents(word) {\n      // If already showing events, hide them and return\n      if (this.showing_events[0] == word) {\n        this.showing_events = [];\n        return;\n      }\n      // TODO: Group events by data\n      const grouped_events = {};\n      for (const event of word.events) {\n        const key = JSON.stringify(event.data);\n        if (key in grouped_events) {\n          grouped_events[key].push(event);\n        } else {\n          grouped_events[key] = [event];\n        }\n      }\n\n      // Construct a new array of events with the grouped events\n      const events = [];\n      for (const key in grouped_events) {\n        const events_group = grouped_events[key];\n        const new_event = {\n          ...events_group[0],\n          duration: 0,\n        };\n        for (const event of events_group) {\n          new_event.duration += event.duration;\n        }\n        events.push(new_event);\n      }\n\n      this.showing_events = [word, events];\n    },\n    ignoreWord(word: string) {\n      console.log('Ignoring word: ' + word);\n      this.ignored_words.push(word);\n    },\n    createRule(word: string) {\n      console.log('Opening modal for creating rule with word: ' + word);\n      this.categoryStore.addClass({\n        name: [word],\n        rule: { type: 'regex', regex: _.escapeRegExp(word) },\n      });\n\n      // Find the category with the max ID, and open an editor for it\n      const lastId = _.max(_.map(this.categoryStore.classes, 'id'));\n      this.create.word = word.word;\n      this.create.categoryId = lastId;\n    },\n    async createRuleOk() {\n      console.log('Creating rule with word: ' + this.create.word);\n      await this.categoryStore.save();\n      this.fetchWords();\n    },\n    async createRuleCancel() {\n      console.log('Cancelling create rule');\n      this.create.categoryId = null;\n      this.categoryStore.load(); // Restore categories to last saved\n    },\n    appendRule(word) {\n      console.log('Opening modal to append rule with word: ' + word);\n      this.append.word = _.escapeRegExp(word);\n      this.$bvModal.show('appendRule');\n    },\n    async appendRuleOk() {\n      console.log('Appending rule with word: ' + this.append.word);\n      const cat = this.categoryStore.get_category(this.append.category);\n      this.categoryStore.appendClassRule(cat.id, this.append.word);\n      await this.categoryStore.save();\n      this.fetchWords();\n    },\n    handleOk(bvModalEvent) {\n      // Prevent modal from closing (to be closed later in handleSubmit, if validation passes)\n      bvModalEvent.preventDefault();\n\n      // Trigger submit handler\n      this.handleSubmit(bvModalEvent);\n    },\n    handleSubmit(e) {\n      // Exit when the form isn't valid\n      if (!this.valid) {\n        //console.log(e);\n        e.preventDefault();\n        return;\n      }\n\n      // Hide the modal manually\n      this.$nextTick(() => {\n        this.$bvModal.hide('appendRule');\n      });\n\n      this.appendRuleOk();\n    },\n  },\n};\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-38.use[2]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./CategoryBuilder.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-38.use[2]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./CategoryBuilder.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./CategoryBuilder.vue?vue&type=template&id=88b09750&lang=pug&\"\nimport script from \"./CategoryBuilder.vue?vue&type=script&lang=ts&\"\nexport * from \"./CategoryBuilder.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./CategoryBuilder.vue?vue&type=style&index=0&id=88b09750&prod&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var toString = require('./toString');\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g,\n    reHasRegExpChar = RegExp(reRegExpChar.source);\n\n/**\n * Escapes the `RegExp` special characters \"^\", \"$\", \"\\\", \".\", \"*\", \"+\",\n * \"?\", \"(\", \")\", \"[\", \"]\", \"{\", \"}\", and \"|\" in `string`.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category String\n * @param {string} [string=''] The string to escape.\n * @returns {string} Returns the escaped string.\n * @example\n *\n * _.escapeRegExp('[lodash](https://lodash.com/)');\n * // => '\\[lodash\\]\\(https://lodash\\.com/\\)'\n */\nfunction escapeRegExp(string) {\n  string = toString(string);\n  return (string && reHasRegExpChar.test(string))\n    ? string.replace(reRegExpChar, '\\\\$&')\n    : string;\n}\n\nmodule.exports = escapeRegExp;\n"],"names":["render","_vm","this","_c","_self","_v","attrs","path","staticClass","_m","_s","queryOptions","hostname","start","stop","on","$event","show_options","directives","name","rawName","value","expression","model","callback","$$v","category","join","loading","words_by_duration","length","_l","word","Math","round","duration","createRule","appendRule","ignoreWord","showEvents","showing_events","event","data","title","_e","create","categoryId","createRuleOk","createRuleCancel","valid","handleOk","ref","stopPropagation","preventDefault","handleSubmit","apply","arguments","validCategory","append","$set","allCategoriesSelect","cat","key","id","text","validPattern","staticStyle","broad_pattern","staticRenderFns","components","CategoryEditModal","props","categoryStore","useCategoryStore","moment","subtract","add","words","ignored_words","computed","mapState","Object","values","sort","a","b","filter","includes","validateRegex","isRegexBroad","watch","handler","fetchWords","deep","mounted","useBucketsStore","ensureLoaded","load","methods","hosts","awclient","getClient","query","canonicalEvents","bid_window","bid_afk","filter_afk","categories","classes_for_query","filter_categories","Date","end","split","events","words_in_event","push","grouped_events","JSON","stringify","events_group","new_event","console","log","addClass","rule","type","regex","lastId","classes","save","$bvModal","show","appendRuleOk","get_category","appendClassRule","bvModalEvent","e","$nextTick","hide","component","toString","reRegExpChar","reHasRegExpChar","RegExp","source","escapeRegExp","string","test","replace","module","exports"],"sourceRoot":""}